<!DOCTYPE html>
<html>
  <head>
    <style>
       #map {
        height: 600px;
        width: 100%;
       }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script type='text/javascript' src='map-icons/dist/js/map-icons.js'></script>
    <script>
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 11,
          center: {lat: 42.3601, lng: -71.0589}
        });

        // Load the geojson and then create new properties for each feature
        map.data.loadGeoJson('FoodViolationData.geojson', null, function(features){
          var maxScore = 0;
          var minScore = 10000;
          features.forEach(function(feature) {
            var score = feature.getProperty("Positivity") - feature.getProperty("Severity");
            feature.setProperty("Score",  score);
            minScore = score < minScore ? score : minScore;
            maxScore = score > maxScore ? score : maxScore;
          });
          console.log("min score = " +minScore);
          console.log("max score = " +maxScore);
        });
        var infowindow = new google.maps.InfoWindow({
          content: 'defaultcontentstring'
        });


        map.data.addListener('click', function(event) {
          infowindow.setContent(getInfoWindowContent(event.feature));
          infowindow.setPosition(event.feature.getGeometry().get());
          infowindow.setOptions({pixelOffset: new google.maps.Size(0,-30)});
          infowindow.open(map);
        });

        map.data.setStyle(function(feature) {
          return {
            icon: 'icons/restaurants.png'
          };
        });
      }

      /**
       * Returns appropriate information window content for a given geojson feature
       * In this case it is an HTML Table
       * @param  {[type]} feature [description]
       * @return {[type]}         [description]
       */
      function getInfoWindowContent(feature) {
        var contentString = "<h3>" + feature.getProperty("businessName") + "</h3>";
        contentString += "<table>";
        var dontShowKeys = new Set(["businessName", "Severity", "Positivity"]);
        feature.forEachProperty(function(val, key) {
          if (!dontShowKeys.has(key)){
            contentString += "<tr>";
            contentString += "<td>" + key + "</td>";
            contentString += "<td>" + val + "</td>"
            contentString += "</tr>";
          }
        });
        contentString += '</table>'
        return contentString;
      }
    </script>
    <script type='text/javascript' src='MapClustering/markerclusterer.js'></script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyClW25CObicg2mBUGPqXxB0299kVHLnpK4&callback=initMap">
    </script>
  </body>
</html>
